!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngeth/utils"),require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("bn.js"),require("@ngeth/provider")):"function"==typeof define&&define.amd?define("@ngeth/contract",["exports","@ngeth/utils","rxjs","rxjs/operators","@angular/core","bn.js","@ngeth/provider"],e):e((t.ngeth=t.ngeth||{},t.ngeth.contract={}),null,t.rxjs,t.rxjs.operators,t.ng.core,null,null)}(this,function(t,y,e,u,r,n,a){"use strict";var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function c(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var d=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function s(t,e,r,n){var o,s=arguments.length,i=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;0<=u;u--)(o=t[u])&&(i=(s<3?o(i):3<s?o(e,r,i):o(e,r))||i);return 3<s&&i&&Object.defineProperty(e,r,i),i}var p=function(){function t(t,e,r,n,o){var s=this;if(this.encoder=t,this.decoder=e,this.provider=r,this.abi=n,this.address=o,this.calls={},this.sends={},this.events={},!this.abi)throw new Error("Please add an abi to the contract");this.address&&(this.address=y.toChecksumAddress(o));var i,u,a=[],c=[],d=[];try{for(var p=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}(this.abi),f=p.next();!f.done;f=p.next()){var h=f.value;"function"===h.type&&!0===h.constant&&a.push(h),"function"===h.type&&!1===h.constant&&c.push(h),"event"===h.type&&d.push(h)}}catch(l){i={error:l}}finally{try{f&&!f.done&&(u=p["return"])&&u.call(p)}finally{if(i)throw i.error}}a.forEach(function(t){return s.calls[t.name]=s.callMethod.bind(s,t)}),c.forEach(function(t){return s.sends[t.name]=s.sendMethod.bind(s,t)}),d.forEach(function(t){return s.events[t.name]=s.eventMethod.bind(s,t)})}return t.prototype.deploy=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=this.abi.find(function(t){return"constructor"===t.type}),s=0===r.length?t:this.encoder.encodeConstructor(o,t,r);return this.fillGas(d({},this.provider.defaultTx,{data:s})).pipe(u.switchMap(function(t){return e.provider.sendTransaction(t)}))},t.prototype.callMethod=function(e){for(var r=this,t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.encoder.encodeMethod(e,t);return this.provider.call(this.address,o).pipe(u.map(function(t){return r.decoder.decodeOutputs(t,e.outputs)}),u.map(function(t){return t[Object.keys(t)[0]]}))},t.prototype.sendMethod=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o={to:this.address,data:this.encoder.encodeMethod(t,r)},s=o.to,i=o.data;return this.fillGas(d({},this.provider.defaultTx,{to:s,data:i})).pipe(u.switchMap(function(t){return e.provider.sendTransaction(t)}))},t.prototype.eventMethod=function(e){var r=this,t=this.encoder.encodeEvent(e);return this.provider.event(this.address,[t]).pipe(u.map(function(t){return r.decoder.decodeEvent(t.topics,t.data,e.inputs)}))},t.prototype.fillGas=function(o){return e.forkJoin(this.provider.estimateGas(o),this.provider.gasPrice()).pipe(u.map(function(t){var e=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,s=r.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(n=s.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=s["return"])&&r.call(s)}finally{if(o)throw o.error}}return i}(t,2),r=e[0],n=e[1];return d({},o,{gas:r,gasPrice:n})}))},t}(),f=function(){function t(){}return t.decorators=[{type:r.NgModule}],t}();function i(t,e){var r=m(e.type),n=d({},e,{name:"",type:r});return Array(t).fill(n)}function h(t){var e=w(t).pop(),r=JSON.parse(e);if(0===r.length)throw new Error("Array of type "+t+" is not a fixed array");return parseInt(r[0],10)}function l(t){return"tuple"===t.type&&t.components&&0===t.components.filter(function(t){return!v(t)}).length}function g(t){return b(t.type)&&v(d({},t,{type:m(t.type)}))}function v(t){var e=t.type;switch(!0){case/\[([0-9]*)\]/.test(e):return g(t);case/tuple?/.test(e):return l(t);case/string?/.test(e):case/bytes?\b/.test(e):return!1;case/bytes?/.test(e):case/int?/.test(e):case/address?/.test(e):case/bool?/.test(e):return!0}return!0}function b(t){return/\[[0-9]\]/.test(t)}function m(t){var e=w(t);if(!e)return t;var r=e[e.length-1];return t.substring(0,t.length-r.length)}function w(t){return t.match(/(\[[0-9]*\])/g)}var x=function(t,e){this.result=t,this.offset=e},S=function(){function t(){}return t.prototype.decodeEvent=function(n,t,e){var o=this,s=this.decodeOutputs(t,e);return e.filter(function(t){return t.indexed}).forEach(function(t,e){var r=n[e+1].replace("0x","");s[t.name]=v(t)?o.decodeBytes(r,t):r}),s},t.prototype.decodeBytes=function(t,e){var r=e.type;switch(!0){case/\[([0-9]*)\]/.test(r):return this.decodeArray(t,e);case/tuple?/.test(r):return this.decodeTuple(t,e.components);case/string?/.test(r):return this.decodeString(t);case/bytes?\b/.test(r):return this.decodeDynamicBytes(t);case/bytes?/.test(r):return this.decodeStaticBytes(t);case/int?/.test(r):return this.decodeInt(t);case/address?/.test(r):return this.decodeAddress(t);case/bool?/.test(r):return this.decodeBool(t);default:throw new Error("Cannot find the decoder for the type : "+r)}},t.prototype.decodeOutputs=function(u,a){var c=this,t={result:{},offset:(u=u.replace("0x","")).length};return a.filter(function(t){return!t.indexed}).reduceRight(function(t,e,r){var n=c.getHead(u,a,r);if(v(e))return t.result[e.name||r]=c.decodeBytes(n,e),new x(t.result,t.offset);var o=2*y.hexToNumber(n),s=t.offset,i=u.substring(o,s);return t.result[e.name||r]=c.decodeBytes(i,e),new x(t.result,o)},t).result},t.prototype.decodeArray=function(t,e){var r;r=b(e.type)?h(e.type):y.hexToNumber(t.slice(0,64));var n=b(e.type)?t:t.slice(64),o=i(r,e),s=this.decodeOutputs(n,o);return Object.keys(s).map(function(t){return s[t]})},t.prototype.decodeTuple=function(t,e){return this.decodeOutputs(t,e)},t.prototype.decodeString=function(t){var e=t.slice(64);return y.hexToUtf8(e)},t.prototype.decodeDynamicBytes=function(t){var e=y.hexToNumber(t.slice(0,64));return t.slice(64).substring(0,2*e)},t.prototype.decodeStaticBytes=function(t){return t.replace(/\b0+(0+)/,"")},t.prototype.decodeInt=function(t){var e;return e=t,"1"===new n.BN(e.substr(0,1),16).toString(2).substr(0,1)?new n.BN(t,16).fromTwos(256).toString(10):y.hexToNumberString(t)},t.prototype.decodeAddress=function(t){return y.toChecksumAddress(t.substring(24))},t.prototype.decodeBool=function(t){return"1"===t.substring(63)},t.prototype.getHead=function(t,e,r){for(var n=0,o=0;o<r;o++){if(l(e[o]))n+=this.getAllHeads(t.substr(n),e[o].components).length;else g(e[o])?n+=this.staticArraySize(t.substr(n),e[r]):n+=64}if(l(e[r])){var s=this.getAllHeads(t.substr(n),e[r].components).length;return t.substr(n,s)}if(g(e[r])){var i=this.staticArraySize(t.substr(n),e[r]);return t.substr(n,i)}return t.substr(n,64)},t.prototype.staticArraySize=function(t,e){var r=i(h(e.type),e);return this.getAllHeads(t,r).length},t.prototype.getAllHeads=function(n,o){var s=this;return o.reduceRight(function(t,e,r){return t+s.getHead(n,o,r)},"")},t.decorators=[{type:r.Injectable,args:[{providedIn:f}]}],t.ngInjectableDef=r.defineInjectable({factory:function(){return new t},token:t,providedIn:f}),t}(),j=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),this.head=t,this.tail=e},E=function(){function t(){}return t.prototype.encodeConstructor=function(t,e,r){var n=this.encodeInputs(r,t.inputs);return e+n.head+n.tail},t.prototype.encodeMethod=function(t,e){t.name;var r=t.inputs,n=this.signMethod(t),o=y.keccak256(n).slice(0,10),s=this.encodeInputs(e,r);return o+s.head+s.tail},t.prototype.encodeEvent=function(t){t.name,t.inputs;var e=this.signMethod(t);return y.keccak256(e)},t.prototype.signInputs=function(t){var e=this;return t.map(function(t){return t.components?e.tupleType(t):t.type}).join(",")},t.prototype.tupleType=function(t){return"("+this.signInputs(t.components)+")"+t.type.substr(5)},t.prototype.signMethod=function(t){var e=t.name,r=t.inputs;return e+"("+this.signInputs(r)+")"},t.prototype.encode=function(e,t){var r=t.type;switch(!0){case/\[([0-9]*)\]/.test(r):return this.encodeArray(e,t);case/tuple?/.test(r):var n=Object.keys(e).map(function(t){return e[t]});return this.encodeTuple(n,t.components);case/string?/.test(r):return this.encodeString(e);case/bytes?\b/.test(r):return this.encodeDynamicBytes(e);case/bytes?/.test(r):return this.encodeStaticBytes(e);case/int?/.test(r):return this.encodeInt(e,t);case/address?/.test(r):return this.encodeAddress(e);case/bool?/.test(r):return this.encodeBool(e);default:throw new Error("Cannot find the encoder for the type : "+r)}},t.prototype.encodeInputs=function(i,t){var u=this,a=64*i.length,e=new j;return t.reduce(function(t,e,r){var n=u.encode(i[r],e),o=(a+t.tail.length)/2;if(v(e))return new j(t.head+n,t.tail);var s=y.numberToHex(o).replace("0x","");return s=u.padStart(s,64,"0"),new j(t.head+s,t.tail+n)},e)},t.prototype.encodeArray=function(t,e){if(0===t.length)throw new Error("No arguments found in array "+e.name);var r="";if(b(e.type)){if(t.length!==h(e.type))throw new Error(t+" should be of size "+h(e.type))}else r=y.numberToHex(t.length).replace("0x",""),r=this.padStart(r,64,"0");var n=i(t.length,e),o=this.encodeInputs(t,n);return r+o.head+o.tail},t.prototype.encodeTuple=function(t,e){var r=this.encodeInputs(t,e);return r.head+r.tail},t.prototype.encodeString=function(t){if("string"!=typeof t)throw new Error("Argument "+t+" should be a string");var e=y.utf8ToHex(t).replace("0x",""),r=y.numberToHex(t.length).replace("0x",""),n=e.length+64-e.length%64;return this.padStart(r,64,"0")+this.padStart(e,n,"0")},t.prototype.encodeDynamicBytes=function(t){if("string"!=typeof t)throw new Error("Argument "+t+" should be a string");var e=t.replace("0x",""),r=y.numberToHex(e.length/2).replace("0x",""),n=e.length+64-e.length%64;return this.padStart(r,64,"0")+this.padEnd(e,n,"0")},t.prototype.encodeStaticBytes=function(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("Argument "+t+" should be a string or number");"number"==typeof t&&(t=t.toString(16));var e=t.replace("0x","");return this.padEnd(e,46,"0")},t.prototype.encodeInt=function(t,e){if("number"!=typeof t)throw new Error("Argument "+t+" should be a number");if(t%1!=0)throw new Error("Only provider integers, Solidity does not manage floats");if(e.type.includes("uint")&&t<0)throw new Error('"uint" cannot be negative at value '+t);return y.toBN(t).toTwos(256).toString(16,64)},t.prototype.encodeAddress=function(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("Argument "+t+" should be a string or number");"number"==typeof t&&(t=t.toString(16));var e=t.replace("0x","");return this.padStart(e,64,"0")},t.prototype.encodeBool=function(t){if("boolean"!=typeof t)throw new Error("Argument "+t+" should be a boolean");return t?this.padStart("1",64,"0"):this.padStart("0",64,"0")},t.prototype.padStart=function(t,e,r){return e>>=0,r=String(void 0!==r?r:" "),t.length>e?String(t):((e-=t.length)>r.length&&(r+=r.repeat(e/r.length)),r.slice(0,e)+String(t))},t.prototype.padEnd=function(t,e,r){return e>>=0,r=String(void 0!==r?r:" "),t.length>e?String(t):((e-=t.length)>r.length&&(r+=r.repeat(e/r.length)),String(t)+r.slice(0,e))},t.decorators=[{type:r.Injectable,args:[{providedIn:f}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t},token:t,providedIn:f}),t}();function A(t){var e=t.abi,s=t.addresses,i="string"==typeof e?JSON.parse(e):e;return function(t){return function(o){function t(t,e,r){var n=o.call(this,t,e,r,i,function(t){switch(t){case 1:return s.mainnet;case 3:return s.ropsten;case 4:return s.rinkeby;case 42:return s.kovan;default:return s.mainnet}}(r.id))||this;return n.encoder=t,n.decoder=e,n.provider=r,n}return c(t,o),t.decorators=[{type:r.Injectable,args:[{providedIn:f}]}],t.ctorParameters=function(){return[{type:E},{type:S},{type:a.ContractProvider}]},t}(p)}}var I=require("./encoder-test.abi.json"),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e=s([A({abi:I,addresses:{ropsten:"0x344f641ff60f6308ad70b1e62052764835f48e00"}})],e)}(p),O=require("./test-event.abi.json"),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e=s([A({abi:O,addresses:{ropsten:"0xc0D6C4cbA14aeFC218d0ff669e07D73E74078248"}})],e)}(p);t.ContractClass=p,t.DecodedParam=x,t.ABIDecoder=S,t.EncodedParam=j,t.ABIEncoder=E,t.Contract=A,t.ContractModule=f,t.EncoderTestContract=T,t.TestEventContract=B,t.ɵb=S,t.ɵa=E,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngeth-contract.umd.min.js.map