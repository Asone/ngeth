!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/operators"),require("@angular/core"),require("@angular/common/http"),require("websocket"),require("rxjs/webSocket"),require("@ngeth/utils"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngeth/provider",["exports","rxjs/operators","@angular/core","@angular/common/http","websocket","rxjs/webSocket","@ngeth/utils","rxjs"],e):e((t.ngeth=t.ngeth||{},t.ngeth.provider={}),t.rxjs.operators,t.ng.core,t.ng.common.http,null,t.rxjs.webSocket,null,t.rxjs)}(this,function(t,n,r,o,e,i,c,u){"use strict";var s=function(){function t(){this.rpcId=0}return t.prototype.req=function(t,e){return{jsonrpc:"2.0",id:this.rpcId,method:t,params:e||[]}},t.prototype.res=function(t,e){return{jsonrpc:t.jsonrpc,id:t.id,result:e}},t.prototype.fetchId=function(){return this.rpcId++,this.rpc("net_version").toPromise()},t.prototype.rpc=function(t,e){var r=this.req(t,e);return this.sendAsync(r).pipe(n.tap(console.log),n.map(function(t){if(t.error)throw t.error;return t.result}))},t.prototype.rpcSub=function(t){var e=this.req("eth_subscribe",t);return this.on(e).pipe(n.map(function(t){return t.params.result}))},t}(),p=new r.InjectionToken("auth"),a=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:s,useExisting:t},{provide:r.APP_INITIALIZER,useFactory:function(e){return function(){return e.fetchId().then(function(t){return e.id=t})}},multi:!0,deps:[s]},{provide:p,useClass:t.Auth}]}},e.decorators=[{type:r.NgModule,args:[{imports:[o.HttpClientModule]}]}],e}(),f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};var d=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},h=function(){function t(){this.observables=[]}return t.prototype.isSubscription=function(t,e){return!!t.method&&"eth_subscription"===t.method&&t.params.subscription===e},t.prototype.response=function(e){return this.socket$.pipe(n.filter(function(t){return t.id===e}),n.first())},t.prototype.subscription=function(e){var r=this;return this.socket$.pipe(n.filter(function(t){return r.isSubscription(t,e)}))},t.prototype.create=function(t){this.socket$=new i.WebSocketSubject({url:t,WebSocketCtor:e.w3cwebsocket})},t.prototype.post=function(t){return this.socket$.next(t),this.response(t.id)},t.prototype.subscribe=function(t){var e=this;return this.socket$.next(t),this.response(t.id).pipe(n.tap(function(t){if(t.error)throw t.error}),n.map(function(t){return t.result}),n.switchMap(function(t){return e.observables[t]=e.subscription(t)}))},t.prototype.unsubscribe=function(){},t.decorators=[{type:r.Injectable,args:[{providedIn:a}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t},token:t,providedIn:a}),t}(),l=function(){function t(t){this.provider=t,this.currentAccount=new u.BehaviorSubject(null),this.account$=this.currentAccount.asObservable()}return Object.defineProperty(t.prototype,"defaultAccount",{get:function(){return this.currentAccount.getValue()},set:function(t){this.currentAccount.next(c.toChecksumAddress(t))},enumerable:!0,configurable:!0}),t.prototype.getAccounts=function(){return this.provider.rpc("eth_accounts")},t.prototype.sendTransaction=function(t,e){return void 0===e&&(e="latest"),this.provider.rpc("eth_sendTransaction",[t,e])},t.prototype.getBalance=function(t,e){return this.provider.rpc("eth_getBalance",[t,e||"latest"])},t.prototype.getTransactionCount=function(t,e){return this.provider.rpc("eth_getTransactionCount",[t,e||"latest"])},t.prototype.sign=function(t,e,r){var n=c.utf8ToHex(t),o="web3"===this.provider.type?"personal_sign":"eth_sign",i="web3"===this.provider.type?[e,n,r]:[n,e];return this.provider.rpc(o,i)},t.decorators=[{type:r.Injectable,args:[{providedIn:a}]}],t.ctorParameters=function(){return[{type:s}]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t(r.inject(s))},token:t,providedIn:a}),t}();var b=function(){function t(t,e){var r=this;this.auth=t,this.provider=e,this.currentTx=new u.BehaviorSubject(null),this.tx$=this.currentTx.asObservable(),this.auth.account$.subscribe(function(t){return r.defaultTx=d({},r.defaultTx,{from:t})}),this.id=this.provider.id}return Object.defineProperty(t.prototype,"defaultTx",{get:function(){return this.currentTx.getValue()},set:function(t){var e=d({},this.currentTx.getValue(),t);this.currentTx.next(e)},enumerable:!0,configurable:!0}),t.prototype.call=function(t,e,r){return void 0===r&&(r="latest"),this.provider.rpc("eth_call",[{to:t,data:e},r])},t.prototype.sendTransaction=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=new c.TxObject(t);return this.auth.sendTransaction(n,e)},t.prototype.event=function(t,e){return this.provider.rpcSub(["logs",{address:t,topics:e}]).pipe(n.map(function(t){return new c.TxLogs(t)}))},t.prototype.estimateGas=function(t){var e=new c.TxObject(t);return this.provider.rpc("eth_estimateGas",[e]).pipe(n.map(function(t){return c.hexToNumber(t.replace("0x",""))}))},t.prototype.gasPrice=function(){return this.provider.rpc("eth_gasPrice",[]).pipe(n.map(function(t){return c.hexToNumberString(t.replace("0x",""))}))},t.decorators=[{type:r.Injectable,args:[{providedIn:a}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:r.Inject,args:[p]}]},{type:s}]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t(r.inject(p),r.inject(s))},token:t,providedIn:a}),t}(),v=function(){function t(t){this.provider=t}return t.prototype.getBlockNumber=function(){return this.provider.rpc("eth_blockNumber").pipe(n.map(function(t){return c.toBN(t).toString(10)}))},t.prototype.getGasPrice=function(){return this.provider.rpc("eth_gasPrice").pipe(n.map(function(t){return c.toBN(t).toString(10)}))},t.prototype.getBlockByNumber=function(t){var e="number"==typeof t?c.numberToHex(t):t;return this.provider.rpc("eth_getBlockByNumber",[e,!0]).pipe(n.map(function(t){return t?new c.Block(t):null}))},t.prototype.getBlockByHash=function(t){return this.provider.rpc("eth_getBlockByNumber",[t,!0]).pipe(n.map(function(t){return t?new c.Block(t):null}))},t.prototype.getTransaction=function(t){return this.provider.rpc("eth_getTransactionByHash",[t]).pipe(n.map(function(t){return t?new c.Transaction(t):null}))},t.prototype.getTransactionReceipt=function(t){return this.provider.rpc("eth_getTransactionReceipt",[t]).pipe(n.map(function(t){return t?new c.TxReceipt(t):null}))},t.prototype.onNewBlock=function(){return this.provider.rpcSub(["newHeads"]).pipe(n.map(function(t){return new c.Block(t)}))},t.prototype.isSyncing=function(){return this.provider.rpcSub(["syncing"])},t.decorators=[{type:r.Injectable,args:[{providedIn:a}]}],t.ctorParameters=function(){return[{type:s}]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t(r.inject(s))},token:t,providedIn:a}),t}();t.AUTH=p,t.ProvidersModule=a,t.Provider=function(c){return function(t){return function(i){function t(t,e){var r=i.call(this)||this;r.http=t,r.ws=e,r.url=c.url||"localhost:8545";var n=new URL(r.url).protocol,o="ws:"===n||"wss:"===n;return window&&"web3"in window?(r.type="web3",r.setWeb3Provider()):o?(r.type="ws",r.setWsProvider()):(r.type="http",r.setHttpProvider()),r}return function(t,e){function r(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,i),t.prototype.setWeb3Provider=function(){var r=this;this.web3Provider=window.web3.currentProvider,this.sendAsync=function(t){var e=r.web3Provider.sendAsync.bind(r.web3Provider,t);return u.bindNodeCallback(e)()}},t.prototype.setWsProvider=function(){var e=this;this.ws.create(this.url),this.on=function(t){return e.rpcId++,e.ws.subscribe(t)},this.sendAsync=function(t){return e.rpcId++,e.ws.post(t)}},t.prototype.setHttpProvider=function(){var e=this;this.sendAsync=function(t){return e.rpcId++,e.http.post(e.url,t)}},t.Auth=c.auth||l,t.decorators=[{type:r.Injectable,args:[{providedIn:a}]}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:h}]},t}(s)}},t.MainProvider=s,t.ContractProvider=b,t.Eth=v,t.Account=l,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngeth-provider.umd.min.js.map